#!/usr/bin/env node

/* eslint no-sync:0 */

/* eslint no-empty:0 */
"use strict";

var _path = _interopRequireDefault(require("path"));

var _semver = _interopRequireDefault(require("semver"));

var _kleur = require("kleur");

var _bootstrap = require("./bootstrap");

var _configPath = _interopRequireDefault(require("./config-path"));

var _utils = require("./utils");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

require('pkginfo')(module);

if (process.getuid && process.getuid() === 0) {
  global.console.warn((0, _kleur.bgYellow)().red("*** WARNING: Verdaccio doesn't need superuser privileges. Don't run it under root! ***"));
}

const MIN_NODE_VERSION = '6.9.0';

if (_semver.default.satisfies(process.version, `>=${MIN_NODE_VERSION}`) === false) {
  global.console.error((0, _kleur.bgRed)(`Verdaccio requires at least Node.js ${MIN_NODE_VERSION} or higher, please upgrade your Node.js distribution`));
  process.exit(1);
}

process.title = 'verdaccio'; // eslint-disable-next-line import/order

const logger = require('./logger');

logger.setup(null, {
  logStart: false
}); // default setup

const envinfo = require('envinfo');

const commander = require('commander');

const pkgVersion = module.exports.version;
const pkgName = module.exports.name;
commander.option('-i, --info', 'prints debugging information about the local environment').option('-l, --listen <[host:]port>', 'host:port number to listen on (default: localhost:4873)').option('-c, --config <config.yaml>', 'use this configuration file (default: ./config.yaml)').version(pkgVersion).parse(process.argv);

function init() {
  let verdaccioConfiguration;
  let configPathLocation;
  const cliListener = commander.listen;

  try {
    configPathLocation = (0, _configPath.default)(commander.config);
    verdaccioConfiguration = (0, _utils.parseConfigFile)(configPathLocation);
    process.title = verdaccioConfiguration.web && verdaccioConfiguration.web.title || 'verdaccio';

    if (!verdaccioConfiguration.self_path) {
      verdaccioConfiguration.self_path = _path.default.resolve(configPathLocation);
    }

    if (!verdaccioConfiguration.https) {
      verdaccioConfiguration.https = {
        enable: false
      };
    }

    logger.logger.warn({
      file: configPathLocation
    }, 'config file  - @{file}');
    (0, _bootstrap.startVerdaccio)(verdaccioConfiguration, cliListener, configPathLocation, pkgVersion, pkgName, _bootstrap.listenDefaultCallback);
  } catch (err) {
    logger.logger.fatal({
      file: configPathLocation,
      err: err
    }, 'cannot open config file @{file}: @{!err.message}');
    process.exit(1);
  }
}

if (commander.info) {
  // eslint-disable-next-line no-console
  console.log('\nEnvironment Info:');

  (async () => {
    const data = await envinfo.run({
      System: ['OS', 'CPU'],
      Binaries: ['Node', 'Yarn', 'npm'],
      Virtualization: ['Docker'],
      Browsers: ['Chrome', 'Edge', 'Firefox', 'Safari'],
      npmGlobalPackages: ['verdaccio']
    }); // eslint-disable-next-line no-console

    console.log(data);
    process.exit(0);
  })();
} else if (commander.args.length == 1 && !commander.config) {
  // handling "verdaccio [config]" case if "-c" is missing in command line
  commander.config = commander.args.pop();
  init();
} else if (commander.args.length !== 0) {
  commander.help();
} else {
  init();
}

process.on('uncaughtException', function (err) {
  logger.logger.fatal({
    err: err
  }, 'uncaught exception, please report this\n@{err.stack}');
  process.exit(255);
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saWIvY2xpLnRzIl0sIm5hbWVzIjpbInJlcXVpcmUiLCJtb2R1bGUiLCJwcm9jZXNzIiwiZ2V0dWlkIiwiZ2xvYmFsIiwiY29uc29sZSIsIndhcm4iLCJyZWQiLCJNSU5fTk9ERV9WRVJTSU9OIiwic2VtdmVyIiwic2F0aXNmaWVzIiwidmVyc2lvbiIsImVycm9yIiwiZXhpdCIsInRpdGxlIiwibG9nZ2VyIiwic2V0dXAiLCJsb2dTdGFydCIsImVudmluZm8iLCJjb21tYW5kZXIiLCJwa2dWZXJzaW9uIiwiZXhwb3J0cyIsInBrZ05hbWUiLCJuYW1lIiwib3B0aW9uIiwicGFyc2UiLCJhcmd2IiwiaW5pdCIsInZlcmRhY2Npb0NvbmZpZ3VyYXRpb24iLCJjb25maWdQYXRoTG9jYXRpb24iLCJjbGlMaXN0ZW5lciIsImxpc3RlbiIsImNvbmZpZyIsIndlYiIsInNlbGZfcGF0aCIsInBhdGgiLCJyZXNvbHZlIiwiaHR0cHMiLCJlbmFibGUiLCJmaWxlIiwibGlzdGVuRGVmYXVsdENhbGxiYWNrIiwiZXJyIiwiZmF0YWwiLCJpbmZvIiwibG9nIiwiZGF0YSIsInJ1biIsIlN5c3RlbSIsIkJpbmFyaWVzIiwiVmlydHVhbGl6YXRpb24iLCJCcm93c2VycyIsIm5wbUdsb2JhbFBhY2thZ2VzIiwiYXJncyIsImxlbmd0aCIsInBvcCIsImhlbHAiLCJvbiJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7O0FBQ0E7OztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7O0FBRUFBLE9BQU8sQ0FBQyxTQUFELENBQVAsQ0FBbUJDLE1BQW5COztBQUVBLElBQUlDLE9BQU8sQ0FBQ0MsTUFBUixJQUFrQkQsT0FBTyxDQUFDQyxNQUFSLE9BQXFCLENBQTNDLEVBQThDO0FBQzVDQyxFQUFBQSxNQUFNLENBQUNDLE9BQVAsQ0FBZUMsSUFBZixDQUNFLHVCQUFXQyxHQUFYLENBQ0Usd0ZBREYsQ0FERjtBQUtEOztBQUVELE1BQU1DLGdCQUFnQixH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QUFSLENBQWEsR0FBYjtBQUNELENBUkQiLCJzb3VyY2VzQ29udGVudCI6WyIjIS91c3IvYmluL2VudiBub2RlXG5cbi8qIGVzbGludCBuby1zeW5jOjAgKi9cbi8qIGVzbGludCBuby1lbXB0eTowICovXG5cbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHNlbXZlciBmcm9tICdzZW12ZXInO1xuaW1wb3J0IHsgYmdZZWxsb3csIGJnUmVkIH0gZnJvbSAna2xldXInO1xuaW1wb3J0IHsgc3RhcnRWZXJkYWNjaW8sIGxpc3RlbkRlZmF1bHRDYWxsYmFjayB9IGZyb20gJy4vYm9vdHN0cmFwJztcbmltcG9ydCBmaW5kQ29uZmlnRmlsZSBmcm9tICcuL2NvbmZpZy1wYXRoJztcbmltcG9ydCB7IHBhcnNlQ29uZmlnRmlsZSB9IGZyb20gJy4vdXRpbHMnO1xuXG5yZXF1aXJlKCdwa2dpbmZvJykobW9kdWxlKTtcblxuaWYgKHByb2Nlc3MuZ2V0dWlkICYmIHByb2Nlc3MuZ2V0dWlkKCkgPT09IDApIHtcbiAgZ2xvYmFsLmNvbnNvbGUud2FybihcbiAgICBiZ1llbGxvdygpLnJlZChcbiAgICAgIFwiKioqIFdBUk5JTkc6IFZlcmRhY2NpbyBkb2Vzbid0IG5lZWQgc3VwZXJ1c2VyIHByaXZpbGVnZXMuIERvbid0IHJ1biBpdCB1bmRlciByb290ISAqKipcIlxuICAgIClcbiAgKTtcbn1cblxuY29uc3QgTUlOX05PREVfVkVSU0lPTiA9ICc2LjkuMCc7XG5cbmlmIChzZW12ZXIuc2F0aXNmaWVzKHByb2Nlc3MudmVyc2lvbiwgYD49JHtNSU5fTk9ERV9WRVJTSU9OfWApID09PSBmYWxzZSkge1xuICBnbG9iYWwuY29uc29sZS5lcnJvcihcbiAgICBiZ1JlZChcbiAgICAgIGBWZXJkYWNjaW8gcmVxdWlyZXMgYXQgbGVhc3QgTm9kZS5qcyAke01JTl9OT0RFX1ZFUlNJT059IG9yIGhpZ2hlciwgcGxlYXNlIHVwZ3JhZGUgeW91ciBOb2RlLmpzIGRpc3RyaWJ1dGlvbmBcbiAgICApXG4gICk7XG4gIHByb2Nlc3MuZXhpdCgxKTtcbn1cblxucHJvY2Vzcy50aXRsZSA9ICd2ZXJkYWNjaW8nO1xuXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgaW1wb3J0L29yZGVyXG5jb25zdCBsb2dnZXIgPSByZXF1aXJlKCcuL2xvZ2dlcicpO1xubG9nZ2VyLnNldHVwKG51bGwsIHsgbG9nU3RhcnQ6IGZhbHNlIH0pOyAvLyBkZWZhdWx0IHNldHVwXG5cbmNvbnN0IGVudmluZm8gPSByZXF1aXJlKCdlbnZpbmZvJyk7XG5jb25zdCBjb21tYW5kZXIgPSByZXF1aXJlKCdjb21tYW5kZXInKTtcbmNvbnN0IHBrZ1ZlcnNpb24gPSBtb2R1bGUuZXhwb3J0cy52ZXJzaW9uO1xuY29uc3QgcGtnTmFtZSA9IG1vZHVsZS5leHBvcnRzLm5hbWU7XG5cbmNvbW1hbmRlclxuICAub3B0aW9uKCctaSwgLS1pbmZvJywgJ3ByaW50cyBkZWJ1Z2dpbmcgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGxvY2FsIGVudmlyb25tZW50JylcbiAgLm9wdGlvbignLWwsIC0tbGlzdGVuIDxbaG9zdDpdcG9ydD4nLCAnaG9zdDpwb3J0IG51bWJlciB0byBsaXN0ZW4gb24gKGRlZmF1bHQ6IGxvY2FsaG9zdDo0ODczKScpXG4gIC5vcHRpb24oJy1jLCAtLWNvbmZpZyA8Y29uZmlnLnlhbWw+JywgJ3VzZSB0aGlzIGNvbmZpZ3VyYXRpb24gZmlsZSAoZGVmYXVsdDogLi9jb25maWcueWFtbCknKVxuICAudmVyc2lvbihwa2dWZXJzaW9uKVxuICAucGFyc2UocHJvY2Vzcy5hcmd2KTtcblxuZnVuY3Rpb24gaW5pdCgpIHtcbiAgbGV0IHZlcmRhY2Npb0NvbmZpZ3VyYXRpb247XG4gIGxldCBjb25maWdQYXRoTG9jYXRpb247XG4gIGNvbnN0IGNsaUxpc3RlbmVyID0gY29tbWFuZGVyLmxpc3RlbjtcblxuICB0cnkge1xuICAgIGNvbmZpZ1BhdGhMb2NhdGlvbiA9IGZpbmRDb25maWdGaWxlKGNvbW1hbmRlci5jb25maWcpO1xuICAgIHZlcmRhY2Npb0NvbmZpZ3VyYXRpb24gPSBwYXJzZUNvbmZpZ0ZpbGUoY29uZmlnUGF0aExvY2F0aW9uKTtcbiAgICBwcm9jZXNzLnRpdGxlID0gKHZlcmRhY2Npb0NvbmZpZ3VyYXRpb24ud2ViICYmIHZlcmRhY2Npb0NvbmZpZ3VyYXRpb24ud2ViLnRpdGxlKSB8fCAndmVyZGFjY2lvJztcblxuICAgIGlmICghdmVyZGFjY2lvQ29uZmlndXJhdGlvbi5zZWxmX3BhdGgpIHtcbiAgICAgIHZlcmRhY2Npb0NvbmZpZ3VyYXRpb24uc2VsZl9wYXRoID0gcGF0aC5yZXNvbHZlKGNvbmZpZ1BhdGhMb2NhdGlvbik7XG4gICAgfVxuICAgIGlmICghdmVyZGFjY2lvQ29uZmlndXJhdGlvbi5odHRwcykge1xuICAgICAgdmVyZGFjY2lvQ29uZmlndXJhdGlvbi5odHRwcyA9IHsgZW5hYmxlOiBmYWxzZSB9O1xuICAgIH1cblxuICAgIGxvZ2dlci5sb2dnZXIud2Fybih7IGZpbGU6IGNvbmZpZ1BhdGhMb2NhdGlvbiB9LCAnY29uZmlnIGZpbGUgIC0gQHtmaWxlfScpO1xuXG4gICAgc3RhcnRWZXJkYWNjaW8oXG4gICAgICB2ZXJkYWNjaW9Db25maWd1cmF0aW9uLFxuICAgICAgY2xpTGlzdGVuZXIsXG4gICAgICBjb25maWdQYXRoTG9jYXRpb24sXG4gICAgICBwa2dWZXJzaW9uLFxuICAgICAgcGtnTmFtZSxcbiAgICAgIGxpc3RlbkRlZmF1bHRDYWxsYmFja1xuICAgICk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZ2dlci5sb2dnZXIuZmF0YWwoXG4gICAgICB7IGZpbGU6IGNvbmZpZ1BhdGhMb2NhdGlvbiwgZXJyOiBlcnIgfSxcbiAgICAgICdjYW5ub3Qgb3BlbiBjb25maWcgZmlsZSBAe2ZpbGV9OiBAeyFlcnIubWVzc2FnZX0nXG4gICAgKTtcbiAgICBwcm9jZXNzLmV4aXQoMSk7XG4gIH1cbn1cblxuaWYgKGNvbW1hbmRlci5pbmZvKSB7XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlXG4gIGNvbnNvbGUubG9nKCdcXG5FbnZpcm9ubWVudCBJbmZvOicpO1xuICAoYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCBlbnZpbmZvLnJ1bih7XG4gICAgICBTeXN0ZW06IFsnT1MnLCAnQ1BVJ10sXG4gICAgICBCaW5hcmllczogWydOb2RlJywgJ1lhcm4nLCAnbnBtJ10sXG4gICAgICBWaXJ0dWFsaXphdGlvbjogWydEb2NrZXInXSxcbiAgICAgIEJyb3dzZXJzOiBbJ0Nocm9tZScsICdFZGdlJywgJ0ZpcmVmb3gnLCAnU2FmYXJpJ10sXG4gICAgICBucG1HbG9iYWxQYWNrYWdlczogWyd2ZXJkYWNjaW8nXVxuICAgIH0pO1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlXG4gICAgY29uc29sZS5sb2coZGF0YSk7XG4gICAgcHJvY2Vzcy5leGl0KDApO1xuICB9KSgpO1xufSBlbHNlIGlmIChjb21tYW5kZXIuYXJncy5sZW5ndGggPT0gMSAmJiAhY29tbWFuZGVyLmNvbmZpZykge1xuICAvLyBoYW5kbGluZyBcInZlcmRhY2NpbyBbY29uZmlnXVwiIGNhc2UgaWYgXCItY1wiIGlzIG1pc3NpbmcgaW4gY29tbWFuZCBsaW5lXG4gIGNvbW1hbmRlci5jb25maWcgPSBjb21tYW5kZXIuYXJncy5wb3AoKTtcbiAgaW5pdCgpO1xufSBlbHNlIGlmIChjb21tYW5kZXIuYXJncy5sZW5ndGggIT09IDApIHtcbiAgY29tbWFuZGVyLmhlbHAoKTtcbn0gZWxzZSB7XG4gIGluaXQoKTtcbn1cblxucHJvY2Vzcy5vbigndW5jYXVnaHRFeGNlcHRpb24nLCBmdW5jdGlvbiAoZXJyKSB7XG4gIGxvZ2dlci5sb2dnZXIuZmF0YWwoXG4gICAge1xuICAgICAgZXJyOiBlcnJcbiAgICB9LFxuICAgICd1bmNhdWdodCBleGNlcHRpb24sIHBsZWFzZSByZXBvcnQgdGhpc1xcbkB7ZXJyLnN0YWNrfSdcbiAgKTtcbiAgcHJvY2Vzcy5leGl0KDI1NSk7XG59KTtcbiJdfQ==